name: Chzzk Smart Downloader
on:
  workflow_dispatch:
    inputs:
      url:
        description: '다운로드할 영상 주소'
        required: true
      start_time:
        description: '시작 시간 (비워두면 전체 다운로드)'
        required: false
      end_time:
        description: '종료 시간 (비워두면 전체 다운로드)'
        required: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg
          pip install yt-dlp
      - name: Download Video
        run: |
          # 입력값이 있는지 확인하여 분기 처리
          START="${{ github.event.inputs.start_time }}"
          END="${{ github.event.inputs.end_time }}"
          URL="${{ github.event.inputs.url }}"

          if [ -z "$START" ] || [ -z "$END" ]; then
            echo "시간 입력이 없어 전체 영상을 다운로드합니다."
            yt-dlp -o "result.mp4" "$URL"
          else
            echo "지정된 구간($START ~ $END)을 다운로드합니다."
            yt-dlp --download-sections "*$START-$END" -o "result.mp4" "$URL"
          fi
      - name: Upload
        uses: actions/upload-artifact@v4
        with:
          name: chzzk-video
          path: result.mp4
